<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="{{ "/css/main.css" | prepend: site.baseurl }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url }}">
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ "/feed.xml" | prepend: site.baseurl | prepend: site.url }}">
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.js'></script>
  <script src="http://cdn.jsdelivr.net/jquery.scrollto/2.1.2/jquery.scrollTo.min.js"></script>
  <script>

    var renderDownloadLinks = function() {
      $('.fhForm').fadeOut();
      $('.fhContent').fadeIn();
    }

    var isValidEmailAddress = function(emailAddress) {
      var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
      return pattern.test(emailAddress);
    };

    var renderError = function(msg) {
      $('.fhForm__input').addClass('error');
      $('.fhForm__error').html(msg);
    }

    $(document).ready(function(){

      $('#dlbtn').click(function() {
        $(this).fadeOut();
        $('.perf').removeClass("perf-flash");
        $('.title2').fadeOut();
        $('.fhForm').fadeIn();
        $('.fhForm__input').focus();
      });

      $('#dlNow').click(function(e) {
        e.preventDefault();
        var emailAddress = $('.fhForm__input').val();
        if ( !emailAddress ) {
          renderError('Email address missing');
        } else if ( isValidEmailAddress(emailAddress) )  {
            $.ajax({
              url: '//api.cloudstitch.com/circadianrhythms/cr---faded-hearing/datasources/sheet',
              type: 'post',
              headers: {'X-Requested-With': 'XMLHttpRequest'},
              dataType: 'json',
              data: $('#FHform').serialize(),
              success: function(data) {
                renderDownloadLinks();
                console.log(data)
              }
            });
        } else {
          renderError('This is not a valid email address â€” try again');
        }
      });

      $('.flashButton').hover(function() {
        $(this).toggleClass("flashButton-inverse");
      }, function() {
        $(this).toggleClass("flashButton-inverse");
      });

      $(window).scroll(function() {
        if($(window).scrollTop() + $(window).height() == $(document).height()) {
          $(window).scrollTop(0)
        }
      });
    });
  </script>
</head>
